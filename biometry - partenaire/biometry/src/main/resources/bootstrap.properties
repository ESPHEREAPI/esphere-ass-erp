#Global configuration
spring.application.name=service-biometrie-partenaire
#Tomcat configuration
#server.port=9112
spring.cloud.config.uri=http://localhost:9101
 #Log level configuration
 logging.level.root=ERROR
 logging.level.webapi=INFO
 logging.level.org.springframework.boot.web.embedded.tomcat=INFO




# ===============================
# JPA / HIBERNATE
# ===============================
spring.jpa.show-sql=true
spring.jpa.hibernate.ddl-auto=none
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect
spring.jpa.propertie.hibernate.dialect=org.hibernate.dialect.MySQL8Dialect
spring.jpa.properties.hibernate.current_session_context_class=org.springframework.orm.hibernate5.SpringSessionContext
spring.jpa.properties.hibernate.dialect.storage_engine=innodb
spring.jpa.database-platform=org.hibernate.dialect.MariaDB53Dialect
@SpringBootApplication(exclude = {JdbcTemplateAutoConfiguration.class})
spring.jpa.show-sql=true
# Configuration de la source de donn\u00e9es MySQL
spring.datasource.url=jdbc:mysql://localhost:3306/biometry?useSSL=false&serverTimezone=UTC&allowPublicKeyRetrieval=true
spring.datasource.username=root
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.datasource.password=DeepWater@2021

# Configuration JPA/Hibernate
spring.jpa.hibernate.ddl-auto=update
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL8Dialect
spring.jpa.show-sql=true
# Validate schema without creating constraints
#spring.jpa.hibernate.ddl-auto=validate
# Activer les logs SQL d\u00e9taill\u00e9s
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE
logging.level.org.hibernate.engine.transaction.internal.TransactionImpl=DEBUG
logging.level.org.hibernate.exception=DEBUG
logging.level.org.hibernate.engine.jdbc.spi.SqlExceptionHelper=ERROR
logging.level.rg.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=trace


# Afficher les exceptions SQL compl\u00e8tes
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=true
spring.jpa.show-sql=true

# Or use update with constraint handling
spring.jpa.properties.hibernate.hbm2ddl.auto=update
#spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL8Dialect

# Skip foreign key constraint creation during schema updates
spring.jpa.properties.hibernate.hbm2ddl.import_files_sql_extractor=org.hibernate.tool.hbm2ddl.MultipleLinesSqlCommandExtractor

# Enable debug mode
debug=true
logging.level.org.springframework.transaction=DEBUG
logging.level.org.hibernate=DEBUG
logging.level.org.springframework.orm.jpa=DEBUG
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE
logging.level.com.mproduits=DEBUG
logging.level.org.springframework.transaction=TRACE


# ===============================
#  le point de terminaison d'arr\u00eat 
# ===============================
management.endpoints.web.exposure.include=*
management.endpoint.shutdown.enabled=true
endpoints.shutdown.enabled=true
management.endpoint.restart.enabled=true

#management.endpoints.web.exposure.include=info

app.jwtSecret=3cfa76ef890d4aed2d3981a7c93bd1a13c8796dafcb4f94fa578234a0df56b321
app.jwtExpirationMs: 86400000
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.enabled=true
springdoc.api-docs.path=/v3/api-docs
#Swagger UI : http://localhost:8080/swagger-ui.html
#OpenAPI JSON : http://localhost:8080/v3/api-docs
# =========================================
# HIKARICP - Pool de connexions
# =========================================
spring.datasource.hikari.pool-name=BiometryHikariPool
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.auto-commit=true
spring.datasource.hikari.connection-test-query=SELECT 1
spring.datasource.hikari.leak-detection-threshold=60000

# =========================================
# JPA / HIBERNATE
# =========================================
spring.jpa.database-platform=org.hibernate.dialect.MySQL8Dialect
spring.jpa.show-sql=${SHOW_SQL:true}
spring.jpa.open-in-view=false

# DDL (create, create-drop, update, validate, none)
spring.jpa.hibernate.ddl-auto=${DDL_AUTO:update}

# Strat\u00e9gie de nommage
spring.jpa.hibernate.naming.physical-strategy=org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl
spring.jpa.hibernate.naming.implicit-strategy=org.springframework.boot.orm.jpa.hibernate.SpringImplicitNamingStrategy

# =========================================
# HIBERNATE PROPERTIES - Performance & Debug
# =========================================
# Formatage SQL pour meilleure lisibilit\u00e9
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.use_sql_comments=true
spring.jpa.properties.hibernate.highlight_sql=true

# Batch Processing pour performance
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.jdbc.fetch_size=50
spring.jpa.properties.hibernate.jdbc.time_zone=UTC
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.batch_versioned_data=true

# Statistiques Hibernate (debug/monitoring)
spring.jpa.properties.hibernate.generate_statistics=${HIBERNATE_STATS:true}

# Cache de second niveau (d\u00e9sactiv\u00e9 par d\u00e9faut)
spring.jpa.properties.hibernate.cache.use_second_level_cache=false
spring.jpa.properties.hibernate.cache.use_query_cache=false

# Dialecte et moteur de stockage
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL8Dialect
spring.jpa.properties.hibernate.storage_engine=innodb

# Gestion des connexions
spring.jpa.properties.hibernate.connection.provider_disables_autocommit=false

# =========================================
# LOGGING - Configuration d\u00e9taill\u00e9e
# =========================================
# Niveau de log g\u00e9n\u00e9ral
logging.level.root=INFO
logging.level.db.biometry=${APP_LOG_LEVEL:DEBUG}

# SQL Queries (voir toutes les requ\u00eates SQL)
logging.level.org.hibernate.SQL=DEBUG

# SQL Parameters (voir les valeurs des param\u00e8tres SQL)
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE

# Batch SQL
logging.level.org.hibernate.engine.jdbc.batch.internal.BatchingBatch=DEBUG

# Transactions Spring
logging.level.org.springframework.transaction=DEBUG
logging.level.org.springframework.orm.jpa=DEBUG

# HikariCP Pool
logging.level.com.zaxxer.hikari=DEBUG

# Spring Data JPA
logging.level.org.springframework.data.jpa=DEBUG

# Pattern de log
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n

# Fichier de log
logging.file.name=logs/biometry-app.log
logging.file.max-size=10MB
logging.file.max-history=30
logging.file.total-size-cap=1GB

# =========================================
# ACTUATOR - Monitoring
# =========================================
management.endpoints.web.exposure.include=health,info,metrics,hikaricp,liquibase
management.endpoint.health.show-details=always
management.metrics.export.simple.enabled=true

# =========================================
# SERVER
# =========================================
server.port=${SERVER_PORT:8080}
server.error.include-message=always
server.error.include-binding-errors=always
server.error.include-stacktrace=on_param

# =========================================
# SPRING CLOUD (si n\u00e9cessaire)
# =========================================
spring.cloud.config.enabled=false
eureka.client.enabled=false
