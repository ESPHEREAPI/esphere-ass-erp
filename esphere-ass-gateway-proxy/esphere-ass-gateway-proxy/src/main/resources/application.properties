# ===== CONFIGURATION GATEWAY =====
spring.application.name=gateway-proxy
server.port=8080

# ===== CONFIG SERVER (D\u00c9SACTIV\u00c9) =====
spring.cloud.config.enabled=false

# ===== EUREKA CLIENT =====
eureka.client.service-url.defaultZone=http://127.0.0.1:8761/eureka/
eureka.client.fetch-registry=true
eureka.client.register-with-eureka=true
#eureka.instance.hostname=77.68.94.193
#eureka.instance.ip-address=77.68.94.193
#eureka.instance.prefer-ip-address=true
#eureka.instance.non-secure-port=8080


# \u2705 IMPORTANT: D\u00e9sactiver discovery locator
spring.cloud.gateway.discovery.locator.enabled=false

# ===== SSL POUR APPELS SORTANTS =====
spring.cloud.gateway.httpclient.ssl.use-insecure-trust-manager=true

# ===== CONFIGURATION CORS =====
spring.cloud.gateway.default-filters[0]=DedupeResponseHeader=Access-Control-Allow-Origin Access-Control-Allow-Credentials, RETAIN_UNIQUE

#spring.cloud.gateway.globalcors.add-to-simple-url-handler-mapping=true
#spring.cloud.gateway.globalcors.cors-configurations.[/**].allowed-origin-patterns=*
#spring.cloud.gateway.globalcors.cors-configurations.[/**].allowed-methods=GET,POST,PUT,DELETE,PATCH,OPTIONS,HEAD
#spring.cloud.gateway.globalcors.cors-configurations.[/**].allowed-headers=*
#spring.cloud.gateway.globalcors.cors-configurations.[/**].allow-credentials=true
#spring.cloud.gateway.globalcors.cors-configurations.[/**].max-age=3600

# ===== ROUTES - URI DIRECTES (sans load balancer) =====

# Route 0: Service Biometrie \u2705
spring.cloud.gateway.routes[0].id=service-biometrie
spring.cloud.gateway.routes[0].uri=http://127.0.0.1:8081
spring.cloud.gateway.routes[0].predicates[0]=Path=/gateway-proxy/api/service-biometrie/**
spring.cloud.gateway.routes[0].filters[0]=StripPrefix=3
spring.cloud.gateway.routes[0].filters[1]=PreserveHostHeader

# Route 1: Service Admin \u2705
spring.cloud.gateway.routes[1].id=service-admin
spring.cloud.gateway.routes[1].uri=http://127.0.0.1:8083
spring.cloud.gateway.routes[1].predicates[0]=Path=/gateway-proxy/api/esphere-ass-microservice-admin/**
spring.cloud.gateway.routes[1].filters[0]=StripPrefix=3
spring.cloud.gateway.routes[1].filters[1]=PreserveHostHeader

# Route 2: Service Biometrie Partenaire \u2705
spring.cloud.gateway.routes[2].id=service-biometrie-partenaire
spring.cloud.gateway.routes[2].uri=http://127.0.0.1:8082
spring.cloud.gateway.routes[2].predicates[0]=Path=/gateway-proxy/api/service-biometrie-partenaire/**
spring.cloud.gateway.routes[2].filters[0]=StripPrefix=3
spring.cloud.gateway.routes[2].filters[1]=PreserveHostHeader

# Route 3: Actuator pour monitoring \u2705
spring.cloud.gateway.routes[3].id=actuator
spring.cloud.gateway.routes[3].uri=http://127.0.0.1:8080
spring.cloud.gateway.routes[3].predicates[0]=Path=/actuator/**
spring.cloud.gateway.routes[3].filters[0]=RewritePath=/actuator/(?<segment>.*), /actuator/$\{segment}

# ===== TIMEOUTS =====
spring.cloud.gateway.httpclient.connect-timeout=10000
spring.cloud.gateway.httpclient.response-timeout=30s

# ===== MONITORING =====
management.endpoints.web.exposure.include=*
management.endpoint.gateway.enabled=true
management.endpoint.health.show-details=always

# ===== LOGGING =====
logging.level.root=INFO
logging.level.org.springframework.cloud.gateway=DEBUG
logging.level.org.springframework.cloud.gateway.handler.RoutePredicateHandlerMapping=DEBUG
logging.level.reactor.netty.http.client=DEBUG
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} - %msg%n