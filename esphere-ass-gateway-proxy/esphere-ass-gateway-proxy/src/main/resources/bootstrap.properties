# Configuration Gateway avec SSL pour appels sortants
spring.application.name=esphere-ass-gateway-proxy
spring.cloud.config.uri=http://localhost:9101
#server.port=8081

# ===== CONFIGURATION SSL POUR APPELS SORTANTS =====
# SOLUTION 1: Pour d\u00e9veloppement - Accepter tous les certificats
spring.cloud.gateway.httpclient.ssl.use-insecure-trust-manager=true

# SOLUTION 2: Pour production - Utiliser un truststore (d\u00e9commentez si n\u00e9cessaire)
# spring.cloud.gateway.httpclient.ssl.trust-store=classpath:truststore.jks
# spring.cloud.gateway.httpclient.ssl.trust-store-password=your_password
# spring.cloud.gateway.httpclient.ssl.trust-store-type=JKS

# ===== CONFIGURATION CORS =====
spring.cloud.gateway.default-filters[0]=DedupeResponseHeader=Access-Control-Allow-Origin Access-Control-Allow-Credentials Access-Control-Allow-Methods Access-Control-Allow-Headers, RETAIN_UNIQUE

spring.cloud.gateway.globalcors.add-to-simple-url-handler-mapping=true
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowed-origin-patterns=https://localhost:*,https://127.0.0.1:*,http://easycom-app:*,http://192.168.123.*:*,http://192.168.1.*:*,http://localhost:4200,https://localhost:4200
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowed-methods=GET,POST,PUT,DELETE,PATCH,OPTIONS,HEAD
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowed-headers=Authorization,Content-Type,Accept,X-Requested-With,Cache-Control,Pragma


spring.cloud.gateway.globalcors.cors-configurations.[/**].allowed-headers=Authorization,Content-Type,Accept,X-Requested-With,Cache-Control
spring.cloud.gateway.globalcors.cors-configurations.[/**].allow-credentials=true
spring.cloud.gateway.globalcors.cors-configurations.[/**].exposed-headers=Authorization,Content-Type,Accept
spring.cloud.gateway.globalcors.cors-configurations.[/**].max-age=3600

# ===== CONFIGURATION DES ROUTES =====

# Route 1: Microservice Biometrie - HTTPS avec gestion SSL
spring.cloud.gateway.routes[0].id=microservice-biometrie
#spring.cloud.gateway.routes[0].uri=https://127.0.0.1:8181
spring.cloud.gateway.routes[0].uri=http://127.0.0.1:8181
spring.cloud.gateway.routes[0].predicates[0]=Path=/gateway-proxy/api/service-biometrie/**
spring.cloud.gateway.routes[0].filters[0]=StripPrefix=3
spring.cloud.gateway.routes[0].filters[1]=PreserveHostHeader
spring.cloud.gateway.routes[0].metadata.response-timeout=180000
spring.cloud.gateway.routes[0].metadata.connect-timeout=5000

# Route 2: Microservice Admin
spring.cloud.gateway.routes[1].id=esphere-ass-microservice-admin
spring.cloud.gateway.routes[1].uri=http://localhost:9002
spring.cloud.gateway.routes[1].predicates[0]=Path=/gateway-proxy/api/esphere-ass-microservice-admin/**
spring.cloud.gateway.routes[1].filters[0]=StripPrefix=2
spring.cloud.gateway.routes[1].filters[1]=PreserveHostHeader

# ===== CONFIGURATION PERFORMANCE ET TIMEOUTS =====
spring.cloud.gateway.httpclient.connect-timeout=30000
spring.cloud.gateway.httpclient.response-timeout=60s
spring.cloud.gateway.httpclient.pool.max-idle-time=400s
spring.cloud.gateway.httpclient.pool.max-life-time=90s
spring.cloud.gateway.httpclient.pool.type=ELASTIC
spring.cloud.gateway.httpclient.pool.max-connections=500

# ===== CONFIGURATION SSL DU SERVEUR (HTTPS ENTRANT) =====
server.ssl.key-store=classpath:keystore.p12
server.ssl.key-store-password=zenithe
server.ssl.keyStoreType=PKCS12
server.ssl.enabled=true
security.require-ssl=true

# ===== MONITORING =====
management.endpoints.web.exposure.include=gateway,health,info,refresh
management.endpoint.gateway.enabled=true

# ===== LOGGING =====
logging.level.org.springframework.cloud.gateway=DEBUG
logging.level.org.springframework.web.cors=DEBUG
logging.level.reactor.netty.http.client=DEBUG
logging.level.org.springframework.cloud.gateway.filter.NettyRoutingFilter=DEBUG
logging.level.org.springframework.cloud.gateway.handler.RoutePredicateHandlerMapping=DEBUG
logging.level.org.springframework.cloud.gateway.route.RouteDefinitionRouteLocator=DEBUG
logging.level.org.springframework.web.reactive=DEBUG
logging.level.org.springframework.cloud.gateway.filter.NettyWriteResponseFilter=TRACE

logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n