<!-- src/app/components/adherents/adherent-form/adherent-form.component.html -->


  <!-- En-tête -->
  <section class="content-header">
    <div class="container-fluid">
      <div class="row mb-2">
        <div class="col-sm-6">
          <h1>
            <i [class]="isEditMode ? 'fas fa-edit' : 'fas fa-plus'"></i>
            {{ isEditMode ? 'Modifier' : 'Créer' }} un Adhérent
          </h1>
        </div>
        <div class="col-sm-6">
          <ol class="breadcrumb float-sm-right">
            <li class="breadcrumb-item"><a href="/dashboard">Accueil</a></li>
            <li class="breadcrumb-item"><a href="/adherents">Adhérents</a></li>
            <li class="breadcrumb-item active">{{ isEditMode ? 'Modifier' : 'Créer' }}</li>
          </ol>
        </div>
      </div>
    </div>
  </section>

  <!-- Contenu principal -->
  <section class="content">
    <div class="container-fluid">
      
      <form [formGroup]="adherentForm" (ngSubmit)="onSubmit()">
        <div class="row">
          
          <!-- Colonne gauche - Photo -->
          <div class="col-md-3">
            <div class="card card-primary card-outline">
              <div class="card-header">
                <h3 class="card-title"><i class="fas fa-camera"></i> Photo</h3>
              </div>
              <div class="card-body text-center">
                <div class="mb-3">
                  <img *ngIf="photoPreview" 
                       [src]="photoPreview" 
                       class="img-fluid rounded"
                       style="max-width: 100%; max-height: 300px;"
                       alt="Photo adhérent">
                  <div *ngIf="!photoPreview" 
                       class="bg-secondary d-flex align-items-center justify-content-center rounded"
                       style="width: 100%; height: 200px;">
                    <i class="fas fa-user fa-5x text-white"></i>
                  </div>
                </div>
                
                <div class="btn-group btn-group-sm btn-block">
                  <label class="btn btn-primary mb-0" style="cursor: pointer;">
                    <i class="fas fa-upload"></i> Charger
                    <input type="file" 
                           accept="image/*" 
                           (change)="onPhotoChange($event)"
                           style="display: none;">
                  </label>
                  <button type="button" 
                          class="btn btn-danger" 
                          *ngIf="photoPreview"
                          (click)="removePhoto()">
                    <i class="fas fa-trash"></i> Supprimer
                  </button>
                </div>
                <small class="text-muted d-block mt-2">
                  Format: JPG, PNG - Max: 5MB
                </small>
              </div>
            </div>

            <!-- Boutons d'action -->
            <div class="card">
              <div class="card-body">
                <button type="submit" 
                        class="btn btn-success btn-block"
                        [disabled]="submitting">
                  <i class="fas" [class.fa-save]="!submitting" [class.fa-spinner]="submitting" [class.fa-spin]="submitting"></i>
                  {{ submitting ? 'Enregistrement...' : 'Enregistrer' }}
                </button>
                <button type="button" 
                        class="btn btn-secondary btn-block"
                        (click)="onCancel()"
                        [disabled]="submitting">
                  <i class="fas fa-times"></i> Annuler
                </button>
              </div>
            </div>
          </div>

          <!-- Colonne droite - Formulaire -->
          <div class="col-md-9">
            
            <!-- Informations personnelles -->
            <div class="card card-primary">
              <div class="card-header">
                <h3 class="card-title"><i class="fas fa-user"></i> Informations Personnelles</h3>
              </div>
              <div class="card-body">
                <div class="row">
                  <!-- Nom complet -->
                  <div class="col-md-6">
                    <div class="form-group">
                      <label>
                        Nom Complet <span class="text-danger">*</span>
                      </label>
                      <input type="text" 
                             class="form-control" 
                             formControlName="assurePrincipal"
                             [class.is-invalid]="hasError('assurePrincipal')"
                             placeholder="Nom complet de l'assuré">
                      <div class="invalid-feedback" *ngIf="hasError('assurePrincipal', 'required')">
                        Le nom est obligatoire
                      </div>
                    </div>
                  </div>

                  <!-- Date de naissance -->
                  <div class="col-md-3">
                    <div class="form-group">
                      <label>
                        Date de Naissance <span class="text-danger">*</span>
                      </label>
                      <input type="date" 
                             class="form-control" 
                             formControlName="naissance"
                             [class.is-invalid]="hasError('naissance')">
                      <div class="invalid-feedback" *ngIf="hasError('naissance', 'required')">
                        La date de naissance est obligatoire
                      </div>
                    </div>
                  </div>

                  <!-- Sexe -->
                  <div class="col-md-3">
                    <div class="form-group">
                      <label>
                        Sexe <span class="text-danger">*</span>
                      </label>
                      <select class="form-control" 
                              formControlName="sexe"
                              [class.is-invalid]="hasError('sexe')">
                        <option *ngFor="let opt of sexeOptions" [value]="opt.value">
                          {{ opt.label }}
                        </option>
                      </select>
                    </div>
                  </div>
                </div>

                <div class="row">
                  <!-- Matricule -->
                  <div class="col-md-4">
                    <div class="form-group">
                      <label>Matricule</label>
                      <input type="text" 
                             class="form-control" 
                             formControlName="matricule"
                             placeholder="Matricule employé">
                    </div>
                  </div>

                  <!-- Téléphone -->
                  <div class="col-md-4">
                    <div class="form-group">
                      <label>Téléphone</label>
                      <input type="tel" 
                             class="form-control" 
                             formControlName="telephone"
                             [class.is-invalid]="hasError('telephone')"
                             placeholder="+237 6XX XX XX XX">
                      <div class="invalid-feedback" *ngIf="hasError('telephone', 'pattern')">
                        Format de téléphone invalide
                      </div>
                    </div>
                  </div>

                  <!-- Email -->
                  <div class="col-md-4">
                    <div class="form-group">
                      <label>Email</label>
                      <input type="email" 
                             class="form-control" 
                             formControlName="email"
                             [class.is-invalid]="hasError('email')"
                             placeholder="email@exemple.com">
                      <div class="invalid-feedback" *ngIf="hasError('email', 'email')">
                        Format d'email invalide
                      </div>
                    </div>
                  </div>
                </div>

                <div class="row">
                  <!-- Adresse -->
                  <div class="col-md-8">
                    <div class="form-group">
                      <label>Adresse</label>
                      <input type="text" 
                             class="form-control" 
                             formControlName="adresse"
                             placeholder="Adresse complète">
                    </div>
                  </div>

                  <!-- Ville -->
                  <div class="col-md-4">
                    <div class="form-group">
                      <label>Ville</label>
                      <input type="text" 
                             class="form-control" 
                             formControlName="ville"
                             placeholder="Ville">
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Informations de couverture -->
            <div class="card card-info">
              <div class="card-header">
                <h3 class="card-title"><i class="fas fa-shield-alt"></i> Informations de Couverture</h3>
              </div>
              <div class="card-body">
                <div class="row">
                  <!-- Souscripteur -->
                  <div class="col-md-6">
                    <div class="form-group">
                      <label>
                        Souscripteur <span class="text-danger">*</span>
                      </label>
                      <input type="text" 
                             class="form-control" 
                             formControlName="souscripteur"
                             [class.is-invalid]="hasError('souscripteur')"
                             placeholder="Code du souscripteur">
                      <div class="invalid-feedback" *ngIf="hasError('souscripteur', 'required')">
                        Le souscripteur est obligatoire
                      </div>
                    </div>
                  </div>

                  <!-- Police -->
                  <div class="col-md-6">
                    <div class="form-group">
                      <label>
                        Numéro de Police <span class="text-danger">*</span>
                      </label>
                      <input type="text" 
                             class="form-control" 
                             formControlName="police"
                             [class.is-invalid]="hasError('police')"
                             placeholder="Numéro de police">
                      <div class="invalid-feedback" *ngIf="hasError('police', 'required')">
                        Le numéro de police est obligatoire
                      </div>
                    </div>
                  </div>
                </div>

                <div class="row">
                  <!-- Date d'effet -->
                  <div class="col-md-4">
                    <div class="form-group">
                      <label>Date d'Effet</label>
                      <input type="date" 
                             class="form-control" 
                             formControlName="effetPolice">
                    </div>
                  </div>

                  <!-- Date d'échéance -->
                  <div class="col-md-4">
                    <div class="form-group">
                      <label>Date d'Échéance</label>
                      <input type="date" 
                             class="form-control" 
                             formControlName="echeancePolice">
                    </div>
                  </div>

                  <!-- Groupe -->
                  <div class="col-md-4">
                    <div class="form-group">
                      <label>Groupe</label>
                      <input type="number" 
                             class="form-control" 
                             formControlName="groupe"
                             placeholder="Numéro de groupe">
                    </div>
                  </div>
                </div>

                <div class="row">
                  <!-- Taux de couverture -->
                  <div class="col-md-4">
                    <div class="form-group">
                      <label>Taux de Couverture (%)</label>
                      <input type="number" 
                             class="form-control" 
                             formControlName="taux"
                             min="0"
                             max="100"
                             [class.is-invalid]="hasError('taux')">
                      <div class="invalid-feedback">
                        Le taux doit être entre 0 et 100
                      </div>
                    </div>
                  </div>

                  <!-- Statut -->
                  <div class="col-md-4">
                    <div class="form-group">
                      <label>
                        Statut <span class="text-danger">*</span>
                      </label>
                      <select class="form-control" 
                              formControlName="statut"
                              [class.is-invalid]="hasError('statut')">
                        <option *ngFor="let opt of statutOptions" [value]="opt.value">
                          {{ opt.label }}
                        </option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Options supplémentaires (en mode édition) -->
            <div class="card card-secondary" *ngIf="isEditMode">
              <div class="card-header">
                <h3 class="card-title"><i class="fas fa-cog"></i> Options</h3>
              </div>
              <div class="card-body">
                <div class="row">
                  <div class="col-md-6">
                    <div class="custom-control custom-switch">
                      <input type="checkbox" 
                             class="custom-control-input" 
                             id="enrole"
                             [checked]="adherentForm.get('enrole')?.value === 'O'"
                             (change)="onImprimeChange($event)">
                      <label class="custom-control-label" for="enrole">
                        <i class="fas fa-fingerprint text-info"></i> Enrôlement biométrique effectué
                      </label>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="custom-control custom-switch">
                      <input type="checkbox" 
                             class="custom-control-input" 
                             id="imprime"
                             [checked]="adherentForm.get('imprime')?.value === 'O'"
                             (change)="onImprimeChange($event)">
                      <label class="custom-control-label" for="imprime">
                        <i class="fas fa-id-card text-success"></i> Carte imprimée
                      </label>
                    </div>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>

        <!-- Boutons fixes en bas pour mobile -->
        <div class="row d-md-none">
          <div class="col-12">
            <div class="card">
              <div class="card-body">
                <button type="submit" 
                        class="btn btn-success btn-block"
                        [disabled]="submitting">
                  <i class="fas" [class.fa-save]="!submitting" [class.fa-spinner]="submitting" [class.fa-spin]="submitting"></i>
                  {{ submitting ? 'Enregistrement...' : 'Enregistrer' }}
                </button>
                <button type="button" 
                        class="btn btn-secondary btn-block"
                        (click)="onCancel()"
                        [disabled]="submitting">
                  <i class="fas fa-times"></i> Annuler
                </button>
              </div>
            </div>
          </div>
        </div>
      </form>

    </div>
  </section>

  <!-- Loader -->
  <div *ngIf="loading" class="overlay">
    <i class="fas fa-3x fa-sync-alt fa-spin"></i>
  </div>

