<!-- Contenu principal -->
<section class="content">
    
    <!-- Bouton de rafraîchissement -->
    <div class="row mb-3">
        <div class="col-xs-12">
            <button class="btn btn-primary pull-right" (click)="rafraichirDonnees()" 
                    [disabled]="isLoadingStats || isLoadingChart">
                <i class="fa fa-refresh" [class.fa-spin]="isLoadingStats || isLoadingChart"></i>
                {{"rafraichir" | translate}}
            </button>
        </div>
    </div>

    <!-- Message d'erreur global -->
    <div class="row" *ngIf="errorStats">
        <div class="col-xs-12">
            <div class="alert alert-danger alert-dismissible">
                <button type="button" class="close" (click)="errorStats = ''">&times;</button>
                <h4><i class="icon fa fa-ban"></i> {{"erreur" | translate}}</h4>
                {{ errorStats }}
            </div>
        </div>
    </div>

    <!-- Cards des prestations en attente de validation -->
    <div class="row">
        
        <!-- Card Consultations -->
        <div class="col-lg-3 col-xs-6">
            <div class="small-box bg-aqua">
                <div class="inner" style="text-align: center;">
                    <h3 *ngIf="!isLoadingStats">{{ nbreConsultations }}</h3>
                    <h3 *ngIf="isLoadingStats">
                        <i class="fa fa-spinner fa-spin"></i>
                    </h3>
                    <p id="libelleConsul" style="color: white;">{{"consultations" | translate}}</p>
                </div>
                <div class="icon">
                    <i class="ion ion-ios-pulse-strong"></i>
                </div>
                <a href="/admin/consultation" class="small-box-footer">
                    {{"voirplus" | translate}} <i class="fa fa-arrow-circle-right"></i>
                </a>
            </div>
        </div>

        <!-- Card Ordonnances -->
        <div class="col-lg-3 col-xs-6">
            <div class="small-box bg-green">
                <div class="inner" style="text-align: center;">
                    <h3 *ngIf="!isLoadingStats">{{ nbreOrdonnances }}</h3>
                    <h3 *ngIf="isLoadingStats">
                        <i class="fa fa-spinner fa-spin"></i>
                    </h3>
                    <p id="libelleOrdonnance" style="color: white;">{{"ordonnances" | translate}}</p>
                </div>
                <div class="icon">
                    <i class="ion ion-document-text"></i>
                </div>
                <a href="/admin/ordonnance" class="small-box-footer">
                    {{"voirplus" | translate}} <i class="fa fa-arrow-circle-right"></i>
                </a>
            </div>
        </div>

        <!-- Card Examens -->
        <div class="col-lg-3 col-xs-6">
            <div class="small-box bg-yellow">
                <div class="inner" style="text-align: center;">
                    <h3 *ngIf="!isLoadingStats">{{ nbreExamens }}</h3>
                    <h3 *ngIf="isLoadingStats">
                        <i class="fa fa-spinner fa-spin"></i>
                    </h3>
                    <p id="libelleExamen" style="color: white;">{{"examens" | translate}}</p>
                </div>
                <div class="icon">
                    <i class="ion ion-beaker"></i>
                </div>
                <a href="/admin/examen" class="small-box-footer">
                    {{"voirplus" | translate}} <i class="fa fa-arrow-circle-right"></i>
                </a>
            </div>
        </div>

    </div>

    <!-- Graphique des statistiques -->
    <div class="row">
        <div class="col-md-12">
            
            <div class="box box-primary">
                <div class="box-header with-border">
                    <h3 class="box-title">
                        <i class="fa fa-bar-chart"></i>
                        {{"consommationParType" | translate}}
                    </h3>
                    
                    <div class="box-tools pull-right">
                        <button type="button" class="btn btn-box-tool" data-widget="collapse">
                            <i class="fa fa-minus"></i>
                        </button>
                        <button type="button" class="btn btn-box-tool" data-widget="remove">
                            <i class="fa fa-times"></i>
                        </button>
                    </div>
                </div>

                <div class="box-body">
                    
                    <!-- Sélecteur d'année -->
                    <div class="row">
                        <div class="col-md-4 col-sm-6">
                            <div class="form-group">
                                <label for="selectAnnee">
                                    <i class="fa fa-calendar"></i> {{"annee" | translate}}
                                </label>
                                <select 
                                    id="selectAnnee" 
                                    class="form-control"
                                    [value]="anneeSelectionnee"
                                    (change)="onAnneeChange($event)"
                                    [disabled]="isLoadingChart">
                                    <option 
                                        *ngFor="let annee of anneesDisponibles" 
                                        [value]="annee"
                                        [selected]="annee === anneeSelectionnee">
                                        {{ annee }}
                                    </option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Message d'erreur du graphique -->
                    <div class="alert alert-danger" *ngIf="errorChart">
                        <i class="icon fa fa-ban"></i>
                        {{ errorChart }}
                    </div>

                    <!-- Indicateur de chargement -->
                    <div class="text-center" *ngIf="isLoadingChart" style="padding: 50px 0;">
                        <i class="fa fa-spinner fa-spin fa-3x fa-fw text-primary"></i>
                        <p class="text-muted">{{"chargementStatistiques" | translate}}</p>
                    </div>

                    <!-- Graphique CanvasJS -->
                    <div *ngIf="!isLoadingChart && !errorChart" class="chart-container">
                        <canvasjs-chart 
                            [options]="chartOptions" 
                            [styles]="{width: '100%', height: '400px'}">
                        </canvasjs-chart>
                    </div>

                </div>

                <!-- Footer de la box avec informations -->
                <div class="box-footer">
                    <div class="row">
                        <div class="col-sm-4 text-center">
                            <div class="description-block">
                                <span class="description-percentage text-aqua">
                                    <i class="fa fa-stethoscope"></i>
                                </span>
                                <h5 class="description-header">{{"consultations" | translate}}</h5>
                                <span class="description-text">{{"prestationsMedicales" | translate}}</span>
                            </div>
                        </div>
                        <div class="col-sm-4 text-center">
                            <div class="description-block">
                                <span class="description-percentage text-green">
                                    <i class="fa fa-medkit"></i>
                                </span>
                                <h5 class="description-header">{{"ordonnances" | translate}}</h5>
                                <span class="description-text">{{"prescriptions" | translate}}</span>
                            </div>
                        </div>
                        <div class="col-sm-4 text-center">
                            <div class="description-block">
                                <span class="description-percentage text-yellow">
                                    <i class="fa fa-flask"></i>
                                </span>
                                <h5 class="description-header">{{"examens" | translate}}</h5>
                                <span class="description-text">{{"analysesMedicales" | translate}}</span>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            
        </div>
    </div>

    <!-- Informations complémentaires -->
    <div class="row">
        
        <!-- Statistiques détaillées -->
        <div class="col-md-8">
            <div class="box box-info">
                <div class="box-header with-border">
                    <h3 class="box-title">
                        <i class="fa fa-info-circle"></i>
                        {{"informationsSurLesDonnees" | translate}}
                    </h3>
                </div>
                <div class="box-body">
                    <dl class="dl-horizontal">
                        <dt>{{"periodeAffichee" | translate}}</dt>
                        <dd>{{"anneeEncaissees" | translate:{ annee: anneeSelectionnee } }}</dd>
                        
                        <dt>{{"enAttente" | translate}}</dt>
                        <dd>{{"cardsAttente" | translate}}</dd>
                        
                        <dt>{{"graphique" | translate}}</dt>
                        <dd>{{"graphiqueDescription" | translate}}</dd>
                        
                        <dt>{{"typesDePrestations" | translate}}</dt>
                        <dd>
                            <span class="label label-info">{{"consultations" | translate}}</span>
                            <span class="label label-success">{{"ordonnances" | translate}}</span>
                            <span class="label label-warning">{{"examens" | translate}}</span>
                        </dd>
                    </dl>
                </div>
            </div>
        </div>

        <!-- Légende des états -->
        <div class="col-md-4">
            <div class="box box-default">
                <div class="box-header with-border">
                    <h3 class="box-title">
                        <i class="fa fa-tags"></i>
                        {{"etatsPrestations" | translate}}
                    </h3>
                </div>
                <div class="box-body">
                    <ul class="list-unstyled">
                        <li>
                            <i class="fa fa-circle text-orange"></i>
                            <strong>{{"enAttenteEtat" | translate}}</strong> {{"validationRequise" | translate}}
                        </li>
                        <li>
                            <i class="fa fa-circle text-green"></i>
                            <strong>{{"encaisseEtat" | translate}}</strong> {{"prestationValidee" | translate}}
                        </li>
                        <li>
                            <i class="fa fa-circle text-red"></i>
                            <strong>{{"rejeteEtat" | translate}}</strong> {{"prestationRefusee" | translate}}
                        </li>
                    </ul>
                </div>
            </div>
        </div>

    </div>

</section>